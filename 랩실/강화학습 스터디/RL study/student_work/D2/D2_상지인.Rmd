---
title: "D2) Markov Reward Process 2"
author: "Jiin Sang"
date: "`r Sys.Date()`"
output:
  pdf_document:
    # extra_dependencies: ["amsmath"]
    latex_engine: xelatex
    highlight: haddock
    keep_tex: yes
    toc: yes
    toc_depth: 2
  html_document:
    toc: yes
    toc_depth: '2'
    df_print: paged
monofont: Consolas
smaller: yes
classoption: a4paper
---


```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)
knitr::opts_chunk$set(background = '718CBA')
library(reticulate)
#py_install("scipy")
```

\newpage
## Method 3- Analytic Solution (p.17)

**Setting Environment**
```{python import, echo=TRUE,message=F}
import numpy as np
import pandas as pd
import matplotlib.pyplot as plt
from matplotlib.ticker import StrMethodFormatter # for setting y-axis decimal points
```

```{python, echo=TRUE}
P = np.matrix([[0.7,0.3],[0.5,0.5]])
R = np.matrix([[1.5,1]]).reshape(2,1)
gamma = 0.9
v = np.linalg.inv(np.identity(2) - gamma * P) * R
print(v[0])
```

\newpage
## Method 4- Iterative Solution - by fixed point theorem (p.21)

```{python, echo=TRUE}
P = np.matrix([[0.7,0.3],[0.5,0.5]])
R = np.matrix([[1.5,1]]).reshape(2,1)
gamma =0.9
epsilion = 10**(-8)
v_old = np.zeros(2).reshape(2,1)

#do-while
while True: 
    v_new =R+gamma*np.dot(P,v_old)
    if np.linalg.norm(v_new-v_old)> epsilion: 
        v_old = v_new
        continue 
    break
print(v_new)
```


\newpage
## Method 4- Iterative Solution - by fixed point theorem (p.24)
```{python}
P = np.matrix([[0.7,0.3],[0.5,0.5]])
R = np.matrix([[1.5,1]]).reshape(2,1)
gamma =0.9
epsilion = 10**(-8)
v_old = np.zeros(2).reshape(2,1)

result=[]
while True: 
    result.append(v_old.T)
    v_new =R+gamma*np.dot(P,v_old)
    if np.linalg.norm(v_new-v_old)> epsilion: 
        v_old = v_new
        continue 
    break
result = pd.DataFrame(np.array(result).reshape(len(result),2), columns = ['coke', 'pepsi'])
print(result)
```
\newpage
## Method 4- Iterative Solution - Plotting (p.25)

```{python}
plt.scatter(result.index,result['coke'], label='coke')
plt.scatter(result.index,result['pepsi'],label='pepsi')

plt.legend()
plt.title('Solving value function using iterative method')
plt.grid(True, axis='both')
plt.xlabel('steps')
plt.ylabel('value function')
plt.show()
```

### After 50 steps
```{python}
plt.scatter(result.index[49:],result['coke'][49:], label='coke')

plt.legend()
plt.title('Solving value function using iterative method after 50 steps')
plt.grid(True, axis='both')
plt.xlabel('steps')
plt.ylabel('value function')
plt.show()
```
### After 100 steps
```{python}
plt.scatter(result.index[99:],result['coke'][99:], label='coke')

plt.gca().yaxis.set_major_formatter(StrMethodFormatter('{x:,.5f}')) # y axis decimal places
plt.legend()
plt.title('Solving value function using iterative method after 100 steps')
plt.grid(True, axis='both')
plt.xlabel('steps')
plt.ylabel('value function')
plt.show()
```

